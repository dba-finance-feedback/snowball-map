# 機能仕様書 - 積立投資可視化ツール

## 概要

積立投資における「各年に積み立てた資金が、最終的な資産にどの程度寄与するか」を可視化するWebアプリケーション。

## 機能要件

### F001: 投資パラメータ入力
**説明**: ユーザーが投資条件を入力できる機能

#### 入力項目
| 項目名 | 形式 | 範囲 | デフォルト値 | 必須 |
|--------|------|------|--------------|------|
| 月次積立額 | 数値(円) | 1,000〜10,000,000 | 33,333 | ○ |
| 想定年利 | 数値(%) | 0.01〜30 | 5.0 | ○ |
| 積立期間 | 数値(年) | 1〜50 | 30 | ○ |

#### 動作仕様
- リアルタイム入力検証
- 入力値変更時の自動再計算（300ms遅延）
- エラー表示（範囲外値、非数値等）

#### UI仕様
```
┌─────────────────────────────┐
│ 投資設定                    │
├─────────────────────────────┤
│ 月次積立額: [33,333] 円     │
│ 想定年利:   [  5.0 ] %      │
│ 積立期間:   [ 30  ] 年      │
│                             │
│ [初期値に戻す]              │
└─────────────────────────────┘
```

### F002: 投資計算エンジン
**説明**: 投資成果を数学的に計算する機能

#### 計算項目
1. **年次別寄与度計算**
   - 各年に積み立てた資金の現在価値
   - 複利効果による成長分

2. **総合計算**
   - 最終積立総額
   - 元本総額
   - 利益総額

#### 計算式
```
年次別現在価値 = 年間積立額 × (1 + 年利)^(残り年数)
最終資産総額 = Σ(年次別現在価値)
```

### F003: 寄与度可視化チャート
**説明**: 各年の積立が最終資産に与える影響を線グラフで表示

#### 仕様 (sample/02_sample_02.png ベース)
- **チャート種類**: 複数線グラフ
- **X軸**: 積立年（1年目〜30年目）
- **Y軸**: 寄与度金額（円）
- **線の数**: 各積立年の寄与度を個別表示

#### 表示データ
- 1年目積立の30年後寄与度
- 2年目積立の29年後寄与度
- ...
- 30年目積立の1年後寄与度

#### インタラクション
- ホバーで詳細値表示
- 凡例のクリックで表示/非表示切り替え
- ズーム・パン機能

### F004: 資産成長可視化チャート  
**説明**: 積立資産の経年変化を積み上げエリアチャートで表示

#### 仕様 (sample/01_sample_01.png ベース)
- **チャート種類**: 積み上げエリアチャート
- **X軸**: 経過年数（1年目〜30年目）
- **Y軸**: 累積資産額（円）
- **積み上げ要素**: 各年の積立が持つ現在価値

#### 表示データ
- 下層: 1年目積立の成長
- 中層: 2年目積立の成長  
- 上層: 30年目積立まで

#### カラーリング
- 寄与度の大きい年ほど濃い色
- 時系列で色相を変化

### F005: 数値サマリー表示
**説明**: 計算結果の数値を分かりやすく表示

#### 表示項目
```
┌─────────────────────────────┐
│ 最終積立金額                │
│ 19,234,608 円               │
├─────────────────────────────┤
│ 元本: 12,000,000 円         │
│ 利益:  7,234,608 円         │
│ 利益率: 60.3%               │
└─────────────────────────────┘
```

### F006: レスポンシブ対応
**説明**: デバイスサイズに応じたUI最適化

#### ブレークポイント
- **デスクトップ**: 1200px以上（2カラムレイアウト）
- **タブレット**: 768px〜1199px（1カラムレイアウト）
- **モバイル**: 767px以下（縦スクロール優先）

#### 適応内容
- チャートサイズ自動調整
- 入力フォームのレイアウト変更
- フォントサイズの最適化

### F007: データ永続化（オプション）
**説明**: 設定値のブラウザ保存機能

#### 保存項目
- 最後に入力した投資パラメータ
- チャート表示設定

#### 実装方式
- LocalStorage使用
- JSON形式で保存
- プライバシー配慮（外部送信なし）

## 非機能要件

### 性能要件
| 項目 | 目標値 |
|------|--------|
| 初期ページロード | 3秒以内 |
| 計算実行時間 | 100ms以内 |
| チャート描画時間 | 500ms以内 |
| メモリ使用量 | 50MB以下 |

### 互換性要件
| ブラウザ | バージョン |
|----------|------------|
| Chrome | 90+ |
| Firefox | 88+ |
| Safari | 14+ |
| Edge | 90+ |

### アクセシビリティ要件
- WCAG 2.1 Level AA準拠
- キーボードナビゲーション対応
- スクリーンリーダー対応
- 色覚多様性対応

## ユーザーストーリー

### US001: 基本的な投資計画確認
```
As a 投資初心者
I want to 積立投資の成果を視覚的に確認したい
So that 長期投資の効果を理解できる
```

**受け入れ基準**:
- 月3万円、年利5%、30年間の条件を入力できる
- 最終資産額が正確に表示される
- チャートで成長過程が確認できる

### US002: 投資戦略の比較検討  
```
As a 投資中級者
I want to 異なる条件での結果を比較したい
So that 最適な投資戦略を決定できる
```

**受け入れ基準**:
- パラメータを変更して即座に結果が更新される
- 各年の寄与度の違いが視覚的に分かる
- 数値での詳細確認ができる

### US003: モバイルでの確認
```
As a モバイルユーザー
I want to スマートフォンでも快適に使用したい  
So that いつでもどこでも投資計画を確認できる
```

**受け入れ基準**:
- スマートフォンでUIが適切に表示される
- タッチ操作でチャートが操作できる
- 表示速度が十分高速である

## エラー仕様

### E001: 入力値エラー
| エラー内容 | 表示メッセージ | 対応動作 |
|------------|----------------|----------|
| 範囲外の値 | "1,000〜10,000,000の範囲で入力してください" | 入力欄を赤枠表示 |
| 非数値入力 | "数値を入力してください" | 前回値に戻す |
| 必須項目未入力 | "必須項目です" | 計算を無効化 |

### E002: 計算エラー
| エラー内容 | 表示メッセージ | 対応動作 |
|------------|----------------|----------|
| 数値オーバーフロー | "計算結果が大きすぎます" | デフォルト値に戻す |
| 無限値 | "計算できない値です" | エラー表示・再入力促進 |

### E003: システムエラー
| エラー内容 | 表示メッセージ | 対応動作 |
|------------|----------------|----------|
| チャート初期化失敗 | "表示エラーが発生しました" | ページリロード案内 |
| メモリ不足 | "処理できませんでした" | 条件見直し案内 |

## テストケース

### 基本機能テスト
1. **正常系テスト**
   - デフォルト値での計算実行
   - パラメータ変更での再計算
   - チャート表示確認

2. **異常系テスト**  
   - 境界値入力テスト
   - 不正値入力テスト
   - エラーメッセージ表示確認

3. **パフォーマンステスト**
   - 大きな数値での計算速度
   - 長期間設定での描画速度
   - メモリ使用量測定

## 更新履歴
- 2025-08-12: 初版作成
- 2025-08-12: 想定年利の最小値を0%から0.01%に変更（0%入力時の計算問題解決）